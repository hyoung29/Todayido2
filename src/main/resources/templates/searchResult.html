<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TodayIdo</title>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
    <script src="path/to/your/local/popper.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        .popup {
            margin: 500px;
        }
    </style>
    <script>
        $(document).ready(function () {
            // Enter 키를 눌렀을 때 검색 기능 실행
            $("#keyword").keypress(function (e) {
                if (e.which === 13) {
                    e.preventDefault();
                    doSearch();
                }
            });

            // 이 함수는 이미 searchResult.html에 포함되어 있는 것 같습니다.
            function doSearch() {
                let keyword = $("#keyword").val().trim();
                if (keyword === "") {
                    showAlert("검색어를 입력하세요.");
                    return;
                }

                // 검색어를 서버로 전송
                $.ajax({
                    type: "post",
                    url: "/content",
                    contentType: "application/json",
                    data: JSON.stringify({"keyword": keyword}),
                    success: function (data) {
                        if (data.length === 0) {
                            showAlert("검색 결과가 없습니다.");
                        } else {
                            displaySearchResults(data);
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            }

            function displaySearchResults(results) {
                let resultsContainer = $("#search-results");
                resultsContainer.empty();

                for (let i = 0; i < results.length; i++) {
                    let result = results[i];
                    let resultItem = $("<div>");
                    resultItem.append("<p><a href='#' class='store-link' data-id='" + result.store_num + "'>" + result.store_name + "</a></p>");
                    resultItem.append("<p>" + result.store_telephone + "</p>");
                    resultItem.append("<p>" + result.store_adress + "</p>");
                    resultsContainer.append(resultItem);
                }

                // 가게 링크에 대한 클릭 이벤트 추가
                $(".store-link").click(function (e) {
                    e.preventDefault();
                    let store_num = $(this).data("id");
                    navigateToContentPage(store_num);
                });
            }

            function navigateToContentPage(store_num) {
                let url = "/content/{store_num}";
                url = url.replace("{store_num}", store_num);
                window.location.href = url;
            }

            function showAlert(message) {
                $("#alert-modal-body").text(message);
                $("#alert-modal").modal("show");
            }
        });
    </script>
</head>
<body>
<header>
    <th:block th:insert="~{fragments::header(${session.user})}"/>
</header>
<section>
    <div th:if="${not #lists.isEmpty(results)}">
        <div id="search-results">
            <table border="1" style="background: #D9D9D9">
                <tbody style="background: #FFFFFF">
                <!-- 검색 결과를 반복문으로 표시 -->
                <td th:each="result : ${results}">
                    <!-- 이미지 경로는 적절히 설정하세요 -->
                    <p><a th:href="@{content(store_num=${result.store_num})}">
                        <img th:src="@{'/images/'+${result.photo_path}}" alt="가게 이미지" style="width: 300px; height: 230px;margin-top: -5%;">
                       </a>
                    </p>
                    <p th:text="${result.store_name}" style="font-size: 180%;font-weight: bolder;margin-top: -20px;"></p>
                    <p th:text="${result.store_adress}" style="margin-top: -5%;font-weight: bolder;font-size: 98%;"></p>
                    <p th:text="${result.menu_name}"></p>
                </td>
                </tbody>
            </table>
        </div>
        <div th:if="${#lists.isEmpty(results)}">
            <p>검색 결과가 없습니다.</p>
        </div>
    </div>
</section>
<footer>
    <th:block th:insert="~{fragments::footer}"/>
</footer>
</body>
</html>

